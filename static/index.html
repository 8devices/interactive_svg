<!DOCTYPE html>
<html>
<head>
    <title>tornado WebSocket example</title>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <script type="text/javascript" src="./jquery.min.js"></script>
    <style type="text/css">
    svg > * {
        -moz-user-select: none;
        -khtml-user-select: none;
        -webkit-user-select: none;
        user-select: none;
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>tornado WebSocket example </h1>
        <hr>
            WebSocket status : <span id="message"></span>
        <hr>
        <object id="svg_img" type="image/svg+xml" data="./8DEV_2400-pinout.svg" height="500" width="1000" ></object>

    </div>

    <script type="text/javascript" src="./svgGui.lib.js"></script> 
    <script>
        // Lets start only when DOM is fully loaded 
        window.addEventListener("load", function() {

            /* Using SVG GUI library to manipulate SVG element. 
             * For library Init function as argument give ID of SVG image container
             */
            var gui = svgGUI.init("svg_img");

            // Open WebSocket
            var ws = new WebSocket('ws://{{(server_url)}}:{{(server_port)}}/ws');
            var $message = $('#message');

            ws.onopen = function(){
                $message.attr("class", 'label label-success');
                $message.text('open');
            };

            ws.onmessage = function(ev){
                $message.attr("class", 'label label-info');
                $message.text(ev.data);


                var json = JSON.parse(ev.data);

                // http://localhost:8888/api?id=1&arg2=LOW&arg1=text5725&arg3=text
                if (json.arg3 == 'text')
                {
                    var text_1 = document.getElementById('svg_img').contentDocument.getElementById(json.arg1).textContent = json.arg2;
                }

                if (json.arg3 == 'set_property')
                {
                    // http://localhost:8888/api?id=1&arg2=fill&arg1=g11048&arg3=set_property&arg4=%23ff0000
                    // http://localhost:8888/api?id=1&arg2=fill&arg1=g11148&arg3=set_property&arg4=%2300ff00
                    // path11108 - D16
                    // path11208 - power

                    // {"arg1": "path11108", "arg2": "fill", "arg3": "set_property", "arg4": "#ff0000", "id": "1"}
                    // {"arg1": "path11208", "arg2": "fill", "arg3": "set_property", "arg4": "#00ff00", "id": "1"}
                    document.getElementById('svg_img').contentDocument.getElementById(json.arg1).style[json.arg2] = json.arg4;
                }
            };

            ws.onclose = function(ev){
                $message.attr("class", 'label label-important');
                $message.text('closed');
            };

            ws.onerror = function(ev){
                $message.attr("class", 'label label-warning');
                $message.text('error occurred');
            };

            // Anonymous function to send events to server using WS
            var sendEvent = function (ev) {
                ws.send('{"' + ev.type + '": "'+ this.id +'"}\r\n');
            }
 
            // For event naming use event type: https://en.wikipedia.org/wiki/DOM_events
            // attachEvent(eventType, elementId, callBackFunction)
            gui.attachEvent('click', 'circle11031', sendEvent);
            gui.attachEvent('mousedown', 'circle11035', sendEvent);
            //gui.attachEvent('mousedown', 'START', sendEvent);
            //gui.removeEvent('mousedown', 'START', sendEvent);

        });
    </script>
</body>
</html>
